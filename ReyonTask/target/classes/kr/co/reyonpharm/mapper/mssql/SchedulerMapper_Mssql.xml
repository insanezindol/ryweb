<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.reyonpharm.mapper.mssql.SchedulerMapper_Mssql">
	
	<select id="selectBtsInfoListCnt" parameterType="BtsInfo" resultType="BtsInfo">
		SELECT /* selectBtsInfoListCnt */
			COUNT(1) CNT
		FROM 
			DBO.SLITEMTAKINGOUT (NOLOCK) A
			LEFT JOIN DBO.SLITEMTAKINGSERIAL (NOLOCK) B ON A.PLANTCODE = B.PLANTCODE AND A.OUTDATE = B.OUTDATE AND A.CHASOO = B.CHASOO AND A.OUTSEQ = B.OUTSEQ AND A.ORDERNO = B.ORDERNO AND A.SEQ = B.SEQ
			LEFT JOIN BARCODEBUNDLE (NOLOCK) E ON B.BUNDLE1SEQ = E.BUNDLESEQ
			LEFT JOIN BARCODEBUNDLE (NOLOCK) E1 ON B.BUNDLE2SEQ = E1.BUNDLESEQ
			LEFT JOIN BARCODEBUNDLE (NOLOCK) E2 ON B.BUNDLE4SEQ = E2.BUNDLESEQ
			JOIN CMCUSTM (NOLOCK) F ON A.CUSTCODE = F.CUSTCODE AND A.PLANTCODE = F.PLANTCODE
			JOIN CMCUSTM (NOLOCK) F1 ON A.CUSTCODE = F1.CUSTCODE AND A.PLANTCODE = F1.PLANTCODE
			JOIN CMITEMM (NOLOCK) G ON A.ITEMCODE = G.ITEMCODE AND A.PLANTCODE = G.PLANTCODE
			JOIN (SELECT DISTINCT A.OUTSEQ, A.SOSEQ, A.ITEMCODE, A.LOTNO, A.ORDERNO, A.SALSEQ FROM INTERFACERY.DBO.E_SALEORDER A) H ON A.ORDERNO = H.OUTSEQ AND A.SEQ = H.SOSEQ AND A.ITEMCODE = H.ITEMCODE AND A.LOTNO = H.LOTNO
		WHERE 1=1
			AND A.OUTDATE = #{outdate}
	</select>
	
	<select id="selectBtsInfoList" parameterType="BtsInfo" resultType="BtsInfo">
		SELECT /* selectBtsInfoList */
			REPLACE(A.OUTDATE,'-','') OUTDATE,
			A.CUSTCODE CUSTCODE,
			H.ECARDCODE ECUSTCODE,
			A.ITEMCODE ITEMCODE,
			A.OUTQTY OUTQTY,
			A.ORDERNO ORDERNO,
			A.SEQ SEQ,
			B.SERIALNO SERIALNO,
			E.SCBARCODE AGG1,
			E1.SCBARCODE AGG2,
			E2.SCBARCODE AGG4,
			H.ORDERNO JUMN_NO,
			H.SALSEQ JPM_SEQ
		FROM 
			DBO.SLITEMTAKINGOUT (NOLOCK) A
			LEFT JOIN DBO.SLITEMTAKINGSERIAL (NOLOCK) B ON A.PLANTCODE = B.PLANTCODE AND A.OUTDATE = B.OUTDATE AND A.CHASOO = B.CHASOO AND A.OUTSEQ = B.OUTSEQ AND A.ORDERNO = B.ORDERNO AND A.SEQ = B.SEQ
			LEFT JOIN BARCODEBUNDLE (NOLOCK) E ON B.BUNDLE1SEQ = E.BUNDLESEQ
			LEFT JOIN BARCODEBUNDLE (NOLOCK) E1 ON B.BUNDLE2SEQ = E1.BUNDLESEQ
			LEFT JOIN BARCODEBUNDLE (NOLOCK) E2 ON B.BUNDLE4SEQ = E2.BUNDLESEQ
			JOIN CMCUSTM (NOLOCK) F ON A.CUSTCODE = F.CUSTCODE AND A.PLANTCODE = F.PLANTCODE
			JOIN CMCUSTM (NOLOCK) F1 ON A.CUSTCODE = F1.CUSTCODE AND A.PLANTCODE = F1.PLANTCODE
			JOIN CMITEMM (NOLOCK) G ON A.ITEMCODE = G.ITEMCODE AND A.PLANTCODE = G.PLANTCODE
			JOIN (SELECT DISTINCT A.OUTSEQ, A.SOSEQ, A.ITEMCODE, A.LOTNO, A.ORDERNO, A.SALSEQ, A.ECARDCODE FROM INTERFACERY.DBO.E_SALEORDER A) H ON A.ORDERNO = H.OUTSEQ AND A.SEQ = H.SOSEQ AND A.ITEMCODE = H.ITEMCODE AND A.LOTNO = H.LOTNO
		WHERE 1=1
			AND A.OUTDATE = #{outdate}
		ORDER BY 
			A.ORDERNO, A.SEQ 
	</select>
	
</mapper>
